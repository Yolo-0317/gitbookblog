# XSS

[https://segmentfault.com/a/1190000016551188](https://segmentfault.com/a/1190000016551188)

跨站脚本攻击（Cross-site scripting，XSS）是一种安全漏洞，攻击者可以利用这种漏洞在网站上注入恶意的客户端代码。

通过修改原始的客户端代码，受害者浏览器的 DOM 环境改变，导致有效载荷的执行

XSS 的本质是：恶意代码未经过滤，与网站正常的代码混在一起；浏览器无法分辨哪些脚本是可信的，导致恶意脚本被执行。

## 2 种情况下，容易发生 XSS 攻击

### 数据从一个不可靠的链接进入到一个 Web 应用程序

### 没有过滤掉恶意代码的动态内容被发送给 Web 用户

## 分类

XSS 攻击可以分为 3 类：存储型（持久型）、反射型（非持久型）、DOM 型。

- 存储区：恶意代码存放的位置。
- 插入点：由谁取得恶意代码，并插入到网页上。

### 存储型 XSS

存储区：后端数据库  插入点：HTML  
注入型脚本永久存储在目标服务器上。当浏览器请求数据时，脚本从服务器上传回并执行。

攻击步骤：

- 攻击者将恶意代码存储到目标网站的服务器中
- 用户打开目标网站时，网站服务端将恶意代码从数据库取出，拼接在html中返回给浏览器
- 用户浏览器接受响应后解析执行，恶意代码也被一同执行
- 恶意代码窃取用户数据发送到攻击者的网站，或者冒充用户行为，调用目标网站接口进行攻击者指定的操作

### 反射型 XSS

存储区：URL  插入点：HTML  
常见于通过 URL 传递参数的功能，如网站搜索、跳转等  
当用户点击一个恶意链接，或者提交一个表单，或者进入一个恶意网站时，注入脚本进入被攻击者的网站。

### 基于 DOM 的 XSS

存储区：后端数据库/前端存储/URL  插入点：前端JS
通过修改原始的客户端代码，受害者浏览器的 DOM 环境改变，导致有效载荷的执行

DOM 中的内联事件监听器，如 location、onclick、onerror、onload、onmouseover 等，<a> 标签的 href 属性，JavaScript 的 eval()、setTimeout()、setInterval() 等，都能把字符串作为代码运行。如果不可信的数据拼接到字符串中传递给这些 API，很容易产生安全隐患，请务必避免。

## 解决方案

XSS 攻击有两大要素：

- 攻击者提交恶意代码。
- 浏览器执行恶意代码。

渲染前端页面（不管是客户端渲染还是服务器端渲染）或者动态插入HTML片段时，任何数据都要先做HTML过滤，然后再渲染

- HTTP-only Cookie: 禁止 JavaScript 读取某些敏感 Cookie，攻击者完成 XSS 注入后也无法窃取此 Cookie。
- 验证码：防止脚本冒充用户提交危险操作。
